---
title: Automate kubeconfig from Rancher with PowerShell
published: false
description: post 001
tags: 'rancher, k8s, powershell, kubeconfig'
cover_image: ./assets/001-cows.jpg
canonical_url: null
id: 2684362
---

<!-- 001-cows.jpg   https://pixabay.com/photos/nature-pasture-livestock-cattle-5625841/ -->

If you're like me and manage multiple Kubernetes clusters using [Rancher](https://www.rancher.com/), you've probably run into situations where you needed to copy the kubeconfig from Rancher to your local machine ‚Äî whether for debugging with `kubectl` or accessing clusters with [k9s](https://k9scli.io/). Personally, I prefer managing everything through `k9s` and leaving the Rancher UI for developers or support teams who don‚Äôt interact with Kubernetes as deeply as I do.

In this post, I‚Äôll show you how I automated this process with a PowerShell script so you can update your local kubeconfig for all clusters in one go.

---

## ‚öôÔ∏è What does this script do?

‚úÖ Connects to multiple Rancher environments
‚úÖ Lists all clusters (or filters by name/provider)
‚úÖ Optionally backs up your existing kubeconfig
‚úÖ Merges or recreates kubeconfig automatically
‚úÖ Leaves you ready to `kubectl get pods` everywhere

---

## üßæ Requirements

* PowerShell Core
* `kubectl` CLI installed and available in your PATH
* Rancher module with helper functions:

  * `Get-RancherClusterAll`
  * `Get-RancherKubeConfig`
  * `Merge-KubeConfigFromRancher`

---

## üí° Why PowerShell Core?

PowerShell Core works on Windows, macOS, and Linux. It‚Äôs perfect for cross-platform automation, and it makes interacting with APIs and files super smooth.

---

## üèÉ‚Äç‚ôÇÔ∏è Example usage

```powershell
$rancherAccounts = @{
    "dev" = @{
        url = "https://rancher-dev.example.com"
        token = "token-xxxxxx"
    }
    "prod" = @{
        url = "https://rancher-prod.example.com"
        token = "token-yyyyyy"
    }
}

# Backup and recreate existing Kubeconfig File
.\set-kubeconfig.ps1 -rancherAccounts $rancherAccounts -backupExisting -recreateConfig

# Specify Backup Path
.\set-kubeconfig.ps1 -rancherAccounts $rancherAccounts -backupExisting -backupPath "C:\Backups\KubeconfigBackups"

# Specify Custom Kubeconfig File Path on Windows
.\set-kubeconfig.ps1 -rancherAccounts $rancherAccounts -kubeConfigFilePath "C:\Users\<user>\.kube\custom-config"

# Select Specific Clusters
.\set-kubeconfig.ps1 -rancherAccounts $rancherAccounts -clusters @("cluster1", "cluster2", "cluster3")

# Filter by Provider
.\set-kubeconfig.ps1 -rancherAccounts $rancherAccounts -provider "aks"
```
---

## üõ†Ô∏è How it works

* Takes in a list of Rancher accounts and optional filters (clusters, provider)
* Figures out your OS-specific kubeconfig location
* Backs up or removes existing config (if you want)
* Fetches and merges all selected cluster configs from Rancher

---

## üöÄ Conclusion

This script has saved me hours of boring manual work and avoided nasty copy-paste errors in my kubeconfig.
If you'd like to try it, [grab the full script here](./scripts/powershell/rancher-set-kubeconfig.ps1). Please note that the script references the `rancher.psm1` module saved in the same path.
The script has only been tested on Windows so far.If you find it useful or have ideas to improve it, feel free to share your thoughts in the comments or share it with others!

---

**Happy clustering!** üéâ

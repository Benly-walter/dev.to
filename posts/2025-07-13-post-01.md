---
title: Automate Kubeconfig from Rancher with PowerShell
published: false
description: post 001
tags: 'rancher, k8s, powershell, kubeconfig'
cover_image: ./assets/001-cows.jpg
canonical_url: null
id: 2684362
---

<!-- 001-cows.jpg   https://pixabay.com/photos/nature-pasture-livestock-cattle-5625841/ -->

If you're like me and manage multiple Kubernetes clusters using Rancher, you've probably run into situations where you needed to copy the kubeconfig from Rancher to your local machine â€” whether for debugging with `kubectl` or accessing clusters with `k9s`. Personally, I prefer managing everything through `k9s` and leaving the Rancher UI for developers or support teams who donâ€™t interact with Kubernetes as deeply as I do.

In this post, Iâ€™ll show you how I automated this process with a PowerShell script so you can update your local kubeconfig for all clusters in one go.

---

## ğŸ’¡ Why PowerShell Core?

PowerShell Core works on Windows, macOS, and Linux. Itâ€™s perfect for cross-platform automation, and it makes interacting with APIs and files super smooth.

---

## âš™ï¸ What does this script do?

âœ… Connects to multiple Rancher environments
âœ… Lists all clusters (or filters by name/provider)
âœ… Optionally backs up your existing kubeconfig
âœ… Merges or recreates kubeconfig automatically
âœ… Leaves you ready to `kubectl get pods` everywhere

---

## ğŸ§¾ Requirements

* PowerShell Core
* `kubectl` CLI installed and available in your PATH
* Rancher module with helper functions:

  * `Get-RancherClusterAll`
  * `Get-RancherKubeConfig`
  * `Merge-KubeConfigFromRancher`

---

## ğŸƒâ€â™‚ï¸ Example usage

```powershell
$rancherAccounts = @{
    "dev" = @{
        url = "https://rancher-dev.example.com"
        token = "token-xxxxxx"
    }
    "prod" = @{
        url = "https://rancher-prod.example.com"
        token = "token-yyyyyy"
    }
}

.\rancher-set-kubeconfig.ps1 `
    -rancherAccounts $rancherAccounts `
    -backupExisting `
    -provider "aks" `
    -clusters @("cluster1", "cluster2")
```

âœ… Connects to both Rancher environments
âœ… Selects clusters named `cluster1` and `cluster2`
âœ… Only includes AKS clusters
âœ… Backs up your current kubeconfig before updating

---

## ğŸ› ï¸ How it works

* Takes in a list of Rancher accounts and optional filters (clusters, provider)
* Figures out your OS-specific kubeconfig location
* Backs up or removes existing config (if you want)
* Fetches and merges all selected cluster configs from Rancher

---

## ğŸš€ Conclusion

This script has saved me hours of boring manual work and avoided nasty copy-paste errors in my kubeconfig.
If you'd like to try it, [grab the full script here](#) (replace with your repo or gist link).
Feedback and improvements are always welcome â€” drop a comment or open a PR if you'd like to contribute!

---

**Happy clustering!** ğŸ‰
